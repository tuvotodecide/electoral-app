appId: com.tuvotodecide
---
# Test: Persistencia de datos y estado de sesión
- launchApp:
    clearState: false
- tapOn: "Open debugger to view warnings."
- assertNotVisible: "Open debugger to view warnings."

# === FASE 1: LOGIN INICIAL Y CONFIGURACIÓN ===
- tapOn: "Tengo una cuenta"
- inputText: "1234"
- assertVisible: "Bienvenido"

# === FASE 2: CONFIGURAR ALGUNOS DATOS ===
- tapOn: "Perfil"
- tapOn: "Datos personales"
- assertVisible: "Nombre completo"
# Nota: Los datos personales vienen del registro, solo verificamos que se muestran
- tapOn: "Regresar"

# === FASE 3: CERRAR Y REABRIR APP SIN CLEAR STATE ===
- launchApp:
    clearState: false

# Debería mantener la sesión activa
- extendedWaitUntil:
    visible: "Bienvenido"
    timeout: 5000
    optional: true

# O debería ir directo al login sin perder configuración
- extendedWaitUntil:
    visible: "Tengo una cuenta"
    timeout: 5000
    optional: true

# Si va al login, verificar que mantiene configuraciones
- tapOn: "Tengo una cuenta"
- inputText: "1234"
- assertVisible: "Bienvenido"

# === FASE 4: VERIFICAR PERSISTENCIA DE CONFIGURACIONES ===
- tapOn: "Perfil"
- scrollUntilVisible:
    element:
      text: "Ajustes de seguridad"
    direction: down
- tapOn: "Ajustes de seguridad"

# Las configuraciones de biometría deberían persistir
- assertVisible: "Huella dactilar"
- assertVisible: "Face ID"

# === FASE 5: CAMBIAR PIN Y VERIFICAR PERSISTENCIA ===
- tapOn: "Cambiar PIN"
- inputText: "1234"
- tapOn: "Continuar"
- inputText: "9876"
- tapOn: "Continuar"
- inputText: "9876"
- tapOn: "Confirmar PIN"
- extendedWaitUntil:
    visible: "PIN actualizado exitosamente"
    timeout: 10000
- tapOn: "Entendido"

# === FASE 6: LOGOUT MANUAL ===
- tapOn: "Más"
- scrollUntilVisible:
    element:
      text: "Cerrar sesión"
    direction: down
- tapOn: "Cerrar sesión"
- tapOn: "Cerrar sesión"

# === FASE 7: VERIFICAR PERSISTENCIA DEL NUEVO PIN ===
- tapOn: "Tengo una cuenta"
# El PIN anterior ya no debería funcionar
- inputText: "1234"
- extendedWaitUntil:
    visible: "PIN incorrecto"
    timeout: 5000

# El nuevo PIN debería funcionar
- inputText: "9876"
- extendedWaitUntil:
    visible: "Bienvenido"
    timeout: 10000

# === FASE 8: CERRAR APP BRUSCAMENTE Y REABRIR ===
- launchApp:
    clearState: false

# Verificar comportamiento después de cierre brusco
- extendedWaitUntil:
    visible: "Tengo una cuenta"
    timeout: 5000
    optional: true

- extendedWaitUntil:
    visible: "Bienvenido"
    timeout: 5000
    optional: true

# Si va al login, usar el PIN actual
- tapOn: "Tengo una cuenta"
- inputText: "9876"
- assertVisible: "Bienvenido"

# === FASE 9: VERIFICAR DATOS DESPUÉS DE REINICIOS ===
- tapOn: "Perfil"
- tapOn: "Datos personales"
- assertVisible: "Nombre completo"
- assertVisible: "CI / N.º de documento"
# Los datos deben seguir ahí
- tapOn: "Regresar"

# === FASE 10: VERIFICAR QR BACKUP PERSISTENCIA ===
- tapOn: "Respaldo con QR"
- assertVisible: "Código QR de recuperación"
- assertVisible:
    id: "qrCodeImage"
    optional: true
# El QR debe seguir siendo el mismo
- tapOn: "Regresar"

# === FASE 11: VERIFICAR CONFIGURACIONES DE GUARDIANES ===
- tapOn: "Guardianes"
- assertVisible: "Tus Guardianes"
# Estado de guardianes debe persistir
- assertVisible:
    text: "No tienes guardianes configurados"
    optional: true
- tapOn: "Regresar"

# === FASE 12: PROBAR MÚLTIPLES REINICIOS ===
- launchApp:
    clearState: false
- tapOn: "Tengo una cuenta"
- inputText: "9876"
- assertVisible: "Bienvenido"

- launchApp:
    clearState: false
- tapOn: "Tengo una cuenta"
- inputText: "9876"
- assertVisible: "Bienvenido"

# === FASE 13: RESTAURAR PIN ORIGINAL ===
- tapOn: "Perfil"
- scrollUntilVisible:
    element:
      text: "Ajustes de seguridad"
    direction: down
- tapOn: "Ajustes de seguridad"
- tapOn: "Cambiar PIN"
- inputText: "9876"
- tapOn: "Continuar"
- inputText: "1234"
- tapOn: "Continuar"
- inputText: "1234"
- tapOn: "Confirmar PIN"
- extendedWaitUntil:
    visible: "PIN actualizado exitosamente"
    timeout: 10000
- tapOn: "Entendido"

# === FASE 14: VERIFICAR PERSISTENCIA DE RESTAURACIÓN ===
- tapOn: "Más"
- scrollUntilVisible:
    element:
      text: "Cerrar sesión"
    direction: down
- tapOn: "Cerrar sesión"
- tapOn: "Cerrar sesión"

- tapOn: "Tengo una cuenta"
- inputText: "1234"
- assertVisible: "Bienvenido"
